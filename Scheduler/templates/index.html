{% extends 'base.html' %}

{% block app_content %}
    <p>Next execution id: {{ executionId }}</p>
    <table style="margin: auto; text-align: center; vertical-align: center">
        {% for experiment in experiments%}
            {% include '_experiment.html' %}
        {% endfor %}
    </table>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        function updateOne(element, newValue){
            if (element.text() !== newValue){
                element.text(newValue);
                element.addClass('highlight');
                setTimeout(function(){element.removeClass('highlight');},3000);
            }
        }
    </script>

    {% for experiment in experiments %}
        <script>
            function update{{ experiment.Id }}() {
                $.get("{{ url_for('experiment.json', experimentId=experiment.Id) }}")
                    .done(function (response) {
                        if (response['Coarse'] === 'ERR'){
                            $("#{{ experiment.Id }}div").fadeTo(500, 0).slideUp(500, function(){ $(this).remove(); });
                        } else {
                            updateOne($("#coarse{{ experiment.Id }}"), response['Coarse']);
                            updateOne($("#status{{ experiment.Id }}"), response['Status']);
                        }
                    });
            }
        </script>

        <script>
            setInterval(update{{experiment.Id}}, 5000);
        </script>
    {% endfor %}
{% endblock %}